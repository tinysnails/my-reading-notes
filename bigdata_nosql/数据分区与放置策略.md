## 数据分区与放置策略
- 海量数据分区的意义
- 数据分区的三种具体方式
- 对一致性哈希进行简单介绍

### 分区的意义
海量数据处理中,不断解决存储空间与数据库性能问题的过程中,产生了分区技术.

方便的处理超大型表,将大型表和索引分成可管理的小块,为大量数据提供了可伸缩的性能.
- 将操作分配给了更小的存储单元,减少进行管理操作的时间
- 并通过并行处理提高性能
- 屏蔽故障分区,提高可用性
- 对应用透明的
- 查询时,不包含任何查询数据的分区被忽略,大大提高系统性能

表使用"分区键:分区, 分区键是确定某个行所在分区的一组列.

分区的优点:
- 提高数据操作的客观理性,可用性和相应的性能
    - 滚动窗口加载进程,添加新的一周数据到新的区
- 某些查询操作不用在整个数据库中进行,缩小了查询操作的范围
- 只针对特定分区维护,提高了维护操作效率

### 分区技术
#### 范围分区
最早最经典,按照表中某个值的范围进行分区.
优点:
- 在按照时间周期存储数据时很适合,销售记录表

#### 列表分区
数据为一系列离散的数值,可进行列表分区.分区键有一个单独的列组成,进行操作,可直接通过所要操作的数据查找分区.

优势:
- 通过分区很方便查找到相应的数据

局限:
- 要求数据重复率比较高
- 分布可能不均匀

特点:
- 对分区字段的离散值进行分区, 比如按省分区
- 不排序,分区之间无关连
- 仅支持单字段 

#### 哈希分区
追求数据在分区上均匀分布的特性

通过统一的哈希函数确定数据在那个分区,所以当主列上数据重复度低,可以用哈系分区

#### 先范围分区,后哈希分区
### 放置策略
海量数据的放置策略:
1. 顺序放置策略
    - 基于成熟的RAID技术
    - 各个存储节点看成逻辑有序,数据副本编号完,映射放置到对应序号节点.
    - 较强数据访问能力和可靠性
    - 稳定,可量化
2. 随机放置策略
    - 某个哈希函数决定数据放置目标
    - 负载均衡,数据访问的本地性较弱,性能影响较大

#### 一致性哈希算法
一致性哈希算法
- 将数据均匀放置在空间上
- 解决数据节点容错性,扩展性
- 引入虚拟节点解决负载均衡

将整个哈希值空间组成一个虚拟的环.哈希空间顺时针方向组织;
首先根据服务器主机名or ip哈希映射到环上,然后所存储的数据哈系映射到环上,数据顺时针找,找到最近的服务器,就存储在那.

- 容错性
    - 一个服务器坏了,直接退出即可,数据会u顺着环找下一台最近的服务器
        - 而一般性哈系的话,需要重新修改哈希算法
- 同理,可扩展,环上加入一台服务器即可,把新增服务器对系统的影响降到最低


虚拟节点

使得数据更均匀的分布在服务器上
- 如果环上有两台紧靠的服务器,那么数据就会集中在顺时针访问的第一台服务器
- 引入虚拟节点, 环上均匀分布多个虚拟节点映射到同一台服务器,数据找到虚拟节点,存储到映射的实际服务器上, 达到均匀分布的目的.


